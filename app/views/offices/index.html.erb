<div class="container mt-4 px-sm-0">
  <div class="clearfix">
    <div class="float-lg-right col-lg-12 mb-3 mb-lg-4 px-0">
      <div class="row align-items-center justify-content-between">
        <h1 class="col col-xl-4 display-2 text-truncate text-uppercase mr-sm-4 mb-3 pr-5">
          <%= t '.title' %>
        </h1>

        <div class="col-lg-6 col-xl">
          <%= form_tag offices_path, method: :get, class: 'search-query-form' do %>
            <div class="input-group">
              <%= search_field_tag :q, index_params[:q], class: 'form-control search-query-input', placeholder: t('.search.placeholder') %>
              <div class="input-group-append">
                <%= link_to icon_tag('times'), offices_path(index_params.except(:q)), class: 'btn search-query-reset' if index_params[:q].present? %>
                <button type="submit" class="btn mt-1 search-query-submit"><%= icon_tag('search') %></button>
              </div>
            </div>

            <% form_params index_params.except(:q, :page) do |name, value| %>
              <%= hidden_field_tag name, value %>
            <% end %>
            <%= hidden_field_tag :l, I18n.locale %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="float-lg-left col-lg-3 mb-5 mb-lg-0 px-0 pr-lg-4">
      <!--
      <div class="facet no-border" data-id="office-sort">
        <h6 class="facet-title" data-toggle="collapse" data-target="#office-sort-content">
          <%= t '.search.sort' %>
        </h6>

        <div id="office-sort-content" class="facet-content collapse show">
          <div class="btn-toolbar w-100" role="toolbar">
            <div class="btn-group btn-group-sm border mb-3 d-flex w-100" role="group">
              <div class="btn-group btn-group-sm flex-grow-1 d-flex" role="group">
                <button type="button" class="btn btn-secondary dropdown-toggle shadow-none border-left-0 border-right border-top-0 border-bottom-0 flex-grow-1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Počet sudcov
                </button>
                <div class="dropdown-menu dropdown-menu-sm">
                    <a href="/courts?l=sk&amp;sort=judges_count" class="dropdown-item">Počet sudcov</a>
                    <a href="/courts?l=sk&amp;sort=hearings_count" class="dropdown-item">Počet pojednávaní</a>
                    <a href="/courts?l=sk&amp;sort=decrees_count" class="dropdown-item">Počet rozhodnutí</a>
                </div>
              </div>
              <%= link_to icon_tag('arrow-up', size: 12), offices_path(index_params.merge(order: 'asc')), class: "btn btn-secondary#{' active' if index_params[:order] == 'asc'} d-flex align-items-center shadow-none border-left border-right border-top-0 border-bottom-0" %>
              <%= link_to icon_tag('arrow-down', size: 12), offices_path(index_params.merge(order: 'desc')), class: "btn btn-secondary#{' active' if index_params[:order] == 'desc'} d-flex align-items-center shadow-none border-left border-right-0 border-top-0 border-bottom-0" %>
            </div>
          </div>
        </div>
      </div>
      -->

      <% time = Benchmark.realtime do %>
        <div class="facet" data-id="office-type">
          <h6 class="facet-title" data-toggle="collapse" data-target="#office-type-content">
            <%= t '.search.type' %>
          </h6>

          <div id="office-type-content" class="facet-content collapse show">
            <div class="facet-results">
              <ul id="court-type-list" class="facet-list">
                <% if @search.facets_for(:type).each do |key, count| %>
                  <li class="facet-item">
                    <%= link_to offices_path(search_params(index_params, type: key)), class: "facet-link#{' active' if search_params?(index_params, :type, key)}" do %>
                      <%= t("offices.types.#{key}") %>
                      <span class="facet-tag"><%= number_with_delimiter(count) %></span>
                    <% end %>
                  </li>
                <% end.empty? %>
                  <span class="text-muted"><%= t '.search.no_types' %></span>
                <% end %>
              </ul>
            </div>
          </div>
        </div>

        <div class="facet" data-id="office-city">
          <h6 class="facet-title" data-toggle="collapse" data-target="#office-city-content">
            <%= t '.search.city' %>
          </h6>

          <div id="office-city-content" class="facet-content collapse show">
            <div class="facet-results">
              <ul id="court-type-list" class="facet-list">
                <% if @search.facets_for(:city).first(10).each do |city, count| %>
                  <li class="facet-item">
                    <%= link_to offices_path(search_params(index_params, city: city)), class: "facet-link#{' active' if search_params?(index_params, :city, city)}" do %>
                      <%= city %>
                      <span class="facet-tag"><%= count %></span>
                    <% end %>
                  </li>
                <% end.empty? %>
                  <span class="text-muted"><%= t '.search.no_cities' %></span>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="float-lg-right col-lg-9 px-0">
        <ol class="search-result-list" start="1">
          <% if @search.paginated.each do |office| %>
            <li class="search-result-item">
              <h4 class="search-result-title">
                <%= link_to office.name, offices_path(office) %>
                <small><%= office.address %></small>
              </h4>

              <div class="search-result-content">
                <% if office.attorney_general.prosecutor.present? %>
                  <%= t ".list.prosecutor_subtitle.#{office.type}_html", link: link_to(office.attorney_general.prosecutor.name, '') %>
                <% else %>
                  <%= t ".list.prosecutor_subtitle.#{office.type}_html", link: office.attorney_general.name %>
                <% end %>
                <br>
                <%= t '.employees_count', count: office.employees.active.count %>
              </div>
            </li>
          <% end.empty? %>
            <div class="alert alert-info mb-0" role="alert">
              <%= t '.search.no_results' %>
            </div>
          <% end %>
        </ol>
      <% end * 1000 %>

      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div class="small text-muted mr-3 mt-4">
          <% if @search.all.any? %>
            <%= t 'search.found_html', count: "#{@search.paginated.offset_value + 1} &ndash; #{@search.paginated.offset_value + @search.paginated.count}".html_safe, total: I18n.t('offices.count', count: @search.paginated.total_count), time: time.to_i %>
          <% else %>
            <%= t '.search.not_found', time: number_with_delimiter(time.to_i) %>
          <% end %>
        </div>

        <% if @search.paginated.any? %>
          <nav class="d-flex align-items-center justify-content-end mt-4">
            <%= paginate @search.paginated %>
          </nav>
        <% end %>
      </div>
    </div>
  </div>
</div>
